<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portfolio | Game</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
    
    :root {
      --lane-1: #FF5C8D;
      --lane-2: #5C8DFF;
      --lane-3: #5CFF8D;
      --lane-4: #FFD15C;
      --lane-5: #D15CFF;
      --bg-gradient: linear-gradient(135deg, #2b2b4b 0%, #1a1a2e 100%);
      --judgement-perfect: #FFD700;
      --judgement-great: #FF8C42;
      --judgement-good: #6BCB77;
      --judgement-bad: #FF6B6B;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: var(--bg-gradient);
      color: white;
      overflow: hidden;
      height: 100vh;
      user-select: none;
    }
    
    #game-container {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    
    #header {
      height: 60px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      background: rgba(0, 0, 0, 0.3);
      z-index: 100;
    }
    
    #logo {
      height: 40px;
      filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
    }
    
    #song-info {
      text-align: center;
      flex-grow: 1;
      margin: 0 20px;
    }
    
    #song-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 2px;
      color: #fff;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
    }
    
    #song-difficulty {
      font-size: 14px;
      color: #ccc;
    }
    
    #game-ui {
      display: flex;
      flex-direction: column;
      height: calc(100% - 60px);
      position: relative;
    }
    
    #game-area {
      flex-grow: 1;
      position: relative;
      overflow: hidden;
      background: url('https://i.imgur.com/JQJQJQJ.png') center/cover;
      background-color: rgba(0, 0, 0, 0.5);
      background-blend-mode: overlay;
    }
    
    #lanes {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 300px;
      display: flex;
      justify-content: center;
    }
    
    .lane {
      width: 80px;
      height: 100%;
      position: relative;
      margin: 0 5px;
    }
    
    .lane::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 100%;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, transparent 100%);
      pointer-events: none;
    }
    
    .lane-1 { background-color: rgba(255, 92, 141, 0.1); }
    .lane-2 { background-color: rgba(92, 141, 255, 0.1); }
    .lane-3 { background-color: rgba(92, 255, 141, 0.1); }
    .lane-4 { background-color: rgba(255, 209, 92, 0.1); }
    .lane-5 { background-color: rgba(209, 92, 255, 0.1); }
    
    .hit-line {
      position: absolute;
      bottom: 120px;
      left: 0;
      right: 0;
      height: 4px;
      background: white;
      box-shadow: 0 0 10px white, 0 0 20px white;
      z-index: 10;
    }
    
    .note {
      position: absolute;
      width: 70px;
      height: 30px;
      border-radius: 5px;
      top: -30px;
      transform-origin: center;
      z-index: 5;
      will-change: transform;
      pointer-events: auto;
    }
    
    .note.lane-1 { background: var(--lane-1); box-shadow: 0 0 10px var(--lane-1); }
    .note.lane-2 { background: var(--lane-2); box-shadow: 0 0 10px var(--lane-2); }
    .note.lane-3 { background: var(--lane-3); box-shadow: 0 0 10px var(--lane-3); }
    .note.lane-4 { background: var(--lane-4); box-shadow: 0 0 10px var(--lane-4); }
    .note.lane-5 { background: var(--lane-5); box-shadow: 0 0 10px var(--lane-5); }
    
    .hold-note {
      height: 0;
      border-radius: 5px 5px 0 0;
    }
    
    .note-effect {
      position: absolute;
      width: 80px;
      height: 80px;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
      border-radius: 50%;
      transform: scale(0);
      opacity: 0;
      pointer-events: none;
      z-index: 6;
    }
    
    #judgement {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 48px;
      font-weight: 700;
      color: white;
      text-shadow: 0 0 10px currentColor;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 20;
    }
    
    .perfect { color: var(--judgement-perfect); }
    .great { color: var(--judgement-great); }
    .good { color: var(--judgement-good); }
    .bad { color: var(--judgement-bad); }
    
    #combo-display {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 36px;
      font-weight: 700;
      color: white;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 20;
    }
    
    #score-display {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      font-weight: 700;
      color: white;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
      z-index: 100;
    }
    
    #progress-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: rgba(255, 255, 255, 0.2);
      z-index: 100;
    }
    
    #progress-bar {
      height: 100%;
      background: linear-gradient(to right, #FF5C8D, #5C8DFF, #5CFF8D, #FFD15C, #D15CFF);
      width: 0%;
      transition: width 0.1s;
    }
    
    #start-screen {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 200;
    }
    
    #start-button {
      background: linear-gradient(135deg, #FF5C8D 0%, #D15CFF 100%);
      border: none;
      color: white;
      padding: 15px 50px;
      font-size: 24px;
      font-weight: 700;
      border-radius: 50px;
      cursor: pointer;
      margin-top: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    #start-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }
    
    #start-button:active {
      transform: translateY(1px);
    }

    .back-button {
      background: linear-gradient(135deg, #ff96b5 0%, #74caff 100%);
      border: none;
      color: white;
      padding: 15px 50px;
      font-size: 24px;
      font-weight: 700;
      border-radius: 50px;
      cursor: pointer;
      margin-top: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .back-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }
    
    .back-button:active {
      transform: translateY(1px);
    }
    
    #character-display {
      position: absolute;
      bottom: 150px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      gap: 20px;
      z-index: 1;
    }
    
    .character {
      width: 120px;
      height: 120px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: bottom;
      filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
      opacity: 0.8;
    }
  </style>

    <audio id="music" preload="auto">
    <source src="https://ia800905.us.archive.org/19/items/miku-hand-in-hand/01%20Hatsune%20Miku%20-%20Hand%20in%20Hand.mp3" type="audio/mpeg">
    </audio>

    <script>
    function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    
    score = 0;
    combo = 0;
    currentNote = 0;
    gameStarted = true;
    startTime = performance.now();
    activeNotes = [];
    
    document.querySelectorAll('.note').forEach(n => n.remove());
    
    updateScore();
    document.getElementById('progress-bar').style.width = '0%';
    
    const music = document.getElementById('music');
    music.currentTime = 0;
    music.volume = 0.7; 
    music.play().catch(e => {
        alert("Silakan klik tombol Start lagi untuk memutar musik");
        document.getElementById('start-screen').style.display = 'flex';
        gameStarted = false;
        return;
    });
    
    startTime = performance.now() - 200;
    
    gameLoop();
    }
</script>
</head>
<body>
  <div id="game-container">
    <div id="header">
      <img id="logo" src="assets/img/icon.jpg" alt="Game in Portfolio">
      <div id="song-info">
        <div id="song-title">Hand in Hand</div>
        <div id="song-difficulty">Level HARD</div>
      </div>
      <div id="score-display">0</div>
    </div>
    
    <div id="game-ui">
      <div id="game-area">
        <div id="character-display">
          <div class="character" src="assets/img/miku-bg.jpg"></div>
        </div>
        
        <div id="lanes">
          <div class="lane lane-1"></div>
          <div class="lane lane-2"></div>
          <div class="lane lane-3"></div>
          <div class="lane lane-4"></div>
          <div class="lane lane-5"></div>
          <div class="hit-line"></div>
        </div>
        
        <div id="judgement"></div>
        <div id="combo-display"></div>
      </div>
      
      <div id="progress-container">
        <div id="progress-bar"></div>
      </div>
    </div>
    
    <div id="start-screen">
      <h1 style="font-size: 48px; color: #fff; margin-bottom: 20px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);">Let's Rhythm!</h1>
      <button id="start-button">START</button>
      <a class="back-button" href="index.html">Back</a>
    </div>
  </div>
  
  <audio id="music" src="https://ia800905.us.archive.org/19/items/miku-hand-in-hand/01%20Hatsune%20Miku%20-%20Hand%20in%20Hand.mp3"></audio>
  
  <script>
    // Hand in Hand rhythm chart (BPM: 150, offset: 0)
    const notes = [
      // Intro (8 beats)
      { time: 800, lane: 3, duration: 0 },
      { time: 1200, lane: 1, duration: 0 },
      { time: 1600, lane: 5, duration: 0 },
      
      // Verse 1
      { time: 2400, lane: 2, duration: 0 }, // "Te" (手)
      { time: 2800, lane: 4, duration: 0 }, // "o" (を)
      { time: 3200, lane: 3, duration: 0 }, // "tsu" (つ)
      { time: 3600, lane: 1, duration: 0 }, // "na" (な)
      { time: 4000, lane: 5, duration: 0 }, // "gi" (ぎ)
      { time: 4400, lane: 2, duration: 0 }, // "ta" (た)
      { time: 4800, lane: 4, duration: 0 }, // "ra" (ら)
      
      // Chorus
      { time: 5600, lane: 1, duration: 0 }, // "Ha" (は)
      { time: 6000, lane: 3, duration: 0 }, // "nd" (ん)
      { time: 6400, lane: 5, duration: 0 }, // "in" (ど)
      { time: 6800, lane: 2, duration: 0 }, // "Ha" (は)
      { time: 7200, lane: 4, duration: 0 }, // "nd" (ん)
      { time: 7600, lane: 1, duration: 200 }, // Hold for "Hand in Hand"
      { time: 8000, lane: 3, duration: 0 },
      { time: 8400, lane: 5, duration: 0 },
      
      // Verse 2
      { time: 9600, lane: 2, duration: 0 },
      { time: 10000, lane: 4, duration: 0 },
      { time: 10400, lane: 3, duration: 0 },
      { time: 10800, lane: 1, duration: 0 },
      { time: 11200, lane: 5, duration: 0 },
      { time: 11600, lane: 2, duration: 0 },
      { time: 12000, lane: 4, duration: 0 },
      
      // Chorus repeat with more intensity
      { time: 12800, lane: 1, duration: 0 },
      { time: 13200, lane: 3, duration: 0 },
      { time: 13600, lane: 5, duration: 0 },
      { time: 14000, lane: 2, duration: 0 },
      { time: 14400, lane: 4, duration: 0 },
      { time: 14800, lane: 1, duration: 200 },
      { time: 15200, lane: 3, duration: 0 },
      { time: 15600, lane: 5, duration: 0 },
      { time: 16000, lane: 2, duration: 0 },
      { time: 16400, lane: 4, duration: 0 },
      { time: 16800, lane: 1, duration: 0 },
      { time: 17200, lane: 3, duration: 0 },
      { time: 17600, lane: 5, duration: 0 },
      
      // Final chorus
      { time: 18400, lane: 1, duration: 0 },
      { time: 18800, lane: 3, duration: 0 },
      { time: 19200, lane: 5, duration: 0 },
      { time: 19600, lane: 2, duration: 0 },
      { time: 20000, lane: 4, duration: 0 },
      { time: 20400, lane: 1, duration: 200 },
      { time: 20800, lane: 3, duration: 0 },
      { time: 21200, lane: 5, duration: 0 },
      { time: 21600, lane: 2, duration: 0 },
      { time: 22000, lane: 4, duration: 0 },
      { time: 22400, lane: 1, duration: 0 },
      { time: 22800, lane: 3, duration: 0 },
      { time: 23200, lane: 5, duration: 0 },
      
      // Ending
      { time: 24000, lane: 3, duration: 0 }
    ];
    
    const lanePositions = [10, 25, 40, 55, 70];
    const APPROACH_RATE = 1.8; 
    const HIT_POSITION = 120; 
    const NOTE_SPEED = 200; 
    const BPM = 150;
    const OFFSET = 0; 
    
    let score = 0;
    let combo = 0;
    let maxCombo = 0;
    let currentNote = 0;
    let gameStarted = false;
    let startTime = 0;
    let activeNotes = [];
    let songDuration = 25000; // 25 seconds for demo
    
    function createNote(noteData) {
      const note = document.createElement('div');
      note.className = `note lane-${noteData.lane}`;
      if (noteData.duration > 0) note.classList.add('hold-note');
      
      // Position based on lane
      const lanePos = lanePositions[noteData.lane - 1];
      note.style.left = `calc(${lanePos}% - 35px)`;
      
      // For hold notes
      if (noteData.duration > 0) {
        note.style.height = `${(noteData.duration / 1000) * NOTE_SPEED * APPROACH_RATE}px`;
      }
      
      note.dataset.time = noteData.time;
      note.dataset.lane = noteData.lane;
      note.dataset.duration = noteData.duration;
      
      note.addEventListener('click', () => handleNoteClick(note));
      
      document.getElementById('game-area').appendChild(note);
      activeNotes.push({
        element: note,
        time: noteData.time,
        lane: noteData.lane,
        duration: noteData.duration,
        hit: false
      });
      
      return note;
    }
    
    function createNoteEffect(x, y, color) {
      const effect = document.createElement('div');
      effect.className = 'note-effect';
      effect.style.left = `${x - 40}px`;
      effect.style.top = `${y - 40}px`;
      effect.style.background = `radial-gradient(circle, ${color} 0%, rgba(255,255,255,0) 70%)`;
      document.getElementById('game-area').appendChild(effect);
      
      // Animate effect
      setTimeout(() => {
        effect.style.transform = 'scale(1.5)';
        effect.style.opacity = '0.8';
      }, 10);
      
      setTimeout(() => {
        effect.style.transform = 'scale(2.5)';
        effect.style.opacity = '0';
        setTimeout(() => effect.remove(), 300);
      }, 100);
    }
    
    function handleNoteClick(note) {
      if (!gameStarted) return;
      
      const noteTime = parseInt(note.dataset.time);
      const currentGameTime = performance.now() - startTime;
      const diff = Math.abs(currentGameTime - noteTime);
      
      let judgement = '';
      let points = 0;
      let judgementClass = '';
      
      if (diff < 50) {
        judgement = 'PERFECT';
        judgementClass = 'perfect';
        points = 300;
        combo++;
      } else if (diff < 100) {
        judgement = 'GREAT';
        judgementClass = 'great';
        points = 200;
        combo++;
      } else if (diff < 150) {
        judgement = 'GOOD';
        judgementClass = 'good';
        points = 100;
        combo++;
      } else {
        judgement = 'BAD';
        judgementClass = 'bad';
        points = 50;
        combo = 0;
      }
      
      score += points;
      if (combo > maxCombo) maxCombo = combo;
      
      updateScore();
      showJudgement(judgement, judgementClass);
      
      // Create tap effect
      const rect = note.getBoundingClientRect();
      const color = getComputedStyle(note).backgroundColor;
      createNoteEffect(rect.left + rect.width/2, rect.top + rect.height/2, color);
      
      // Remove the note
      const noteIndex = activeNotes.findIndex(n => n.element === note);
      if (noteIndex !== -1) {
        activeNotes[noteIndex].hit = true;
        animateNoteRemoval(note);
      }
    }
    
    function animateNoteRemoval(note) {
      note.style.transform = 'scale(1.2)';
      note.style.opacity = '0';
      setTimeout(() => note.remove(), 200);
    }
    
    function showJudgement(judgement, judgementClass) {
      const judgementEl = document.getElementById('judgement');
      judgementEl.textContent = judgement;
      judgementEl.className = judgementClass;
      judgementEl.style.opacity = '1';
      judgementEl.style.transform = 'translateX(-50%) scale(1.2)';
      
      // Show combo if > 0
      if (combo > 0) {
        const comboEl = document.getElementById('combo-display');
        comboEl.textContent = `${combo}`;
        comboEl.style.opacity = '1';
      }
      
      setTimeout(() => {
        judgementEl.style.opacity = '0';
        judgementEl.style.transform = 'translateX(-50%) scale(1)';
        
        if (combo === 0) {
          document.getElementById('combo-display').style.opacity = '0';
        }
      }, 500);
    }
    
    function updateScore() {
      document.getElementById('score-display').textContent = score.toLocaleString();
    }
    
    function startGame() {
      document.getElementById('start-screen').style.display = 'none';
      
      score = 0;
      combo = 0;
      currentNote = 0;
      gameStarted = true;
      startTime = performance.now() + OFFSET;
      activeNotes = [];
      
      document.querySelectorAll('.note').forEach(n => n.remove());
      
      updateScore();
      document.getElementById('progress-bar').style.width = '0%';
      
      const music = document.getElementById('music');
      music.currentTime = 0;
      music.play();
      
      gameLoop();
    }
    
    function gameLoop() {
      if (!gameStarted) return;
      
      const currentGameTime = performance.now() - startTime;
      
      const progress = Math.min(100, (currentGameTime / songDuration) * 100);
      document.getElementById('progress-bar').style.width = `${progress}%`;
      
      while (currentNote < notes.length && currentGameTime >= notes[currentNote].time - (1000 * APPROACH_RATE)) {
        if (!activeNotes.some(n => n.time === notes[currentNote].time && n.lane === notes[currentNote].lane)) {
          createNote(notes[currentNote]);
        }
        currentNote++;
      }
      
      // Move notes from top to bottom
      activeNotes.forEach(note => {
        if (!note.hit) {
          const noteElement = note.element;
          const noteTopPos = ((currentGameTime - note.time) / 1000) * NOTE_SPEED * APPROACH_RATE;
          
          if (note.duration > 0) {
            noteElement.style.top = `${noteTopPos}px`;
          } else {
            noteElement.style.top = `${noteTopPos}px`;
          }
          
          // Remove notes that are past the hit line without being hit
          const noteBottomPos = noteTopPos + (note.duration > 0 ? 
            (note.duration / 1000) * NOTE_SPEED * APPROACH_RATE : 
            30);
            
          if (noteBottomPos > (document.getElementById('game-area').offsetHeight - HIT_POSITION + 30) && !note.hit) {
            note.hit = true;
            combo = 0;
            updateScore();
            showJudgement('BAD', 'bad');
            animateNoteRemoval(noteElement);
          }
        }
      });
      
      activeNotes = activeNotes.filter(n => !n.hit);
      
      if (currentGameTime >= songDuration && activeNotes.length === 0) {
        endGame();
      } else {
        requestAnimationFrame(gameLoop);
      }
    }
    
    function endGame() {
      gameStarted = false;
      setTimeout(() => {
        alert(`Song Complete!\nFinal Score: ${score.toLocaleString()}\nMax Combo: ${maxCombo}\nAccuracy: ${Math.round((score / (notes.length * 300)) * 100)}%`);
        document.getElementById('start-screen').style.display = 'flex';
      }, 1000);
    }
    
    document.getElementById('start-button').addEventListener('click', startGame);
  </script>
</body>
</html>